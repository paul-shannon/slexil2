<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
  </head>

  <body>

    <div style="margin-left: 100px; margin-top: 20px; margin-bottom: 10px;">

      <audio id="audioPlayer" controls  preload="auto">
		  <source src="daylight.wav"/>
      </audio>
      <br><button onclick="playAudioSegment(1.000, 3.000)">Play Daylight, 1.0-3.0</button>
      <br><button onclick="playAudioSegment(20.000, 25.500)">Play Daylight, 20.0-25.5</button>
      <br><button onclick="playVideoSegment(200, 203)">Play Ruth, 200-203</button>
      <br><button onclick="playVideoSegment(50, 53)">Play Ruth, 50-53</button>
      <!-- br><button onclick="preloadVideo()">Preload Video</button-->
    </div>

    <div style="border: 1px solid red; width: 800px; margin:20px; padding: 10px;">
      Safari, because it often runs on a phone in ios, will not preload a large video file.
      It loads the video from the server only after a "user gesture" - a button click,
      for instance.  Chrome and Firefox support "preload", and we use it here.
      <p>
      On David's suggestion (if I got it right) any user scrolling will pause the video.
      </div>

  <div id="movieDiv" style="margin-left: 40px;">
    <video id="videoPlayer"  controls width="800" preload="auto">
      <source src="1RuthNora2Wide.m4v" type="video/mp4">
        Your browser does not support the video tag.
    </video>
  </div id="movieDiv">


<script>
// from https://stackoverflow.com/questions/5932412/html5-audio-how-to-play-only-a-selected-portion-of-an-audio-file-audio-sprite
//----------------------------------------------------------------------------------------------------
var audioPlayer = document.getElementById("audioPlayer");
var audioSegmentEnd;
var audioContinuousPlay = true

audioPlayer.addEventListener("timeupdate", function (){
   //console.log("audio timeupdate: " + audioPlayer.currentTime);
   if (!audioContinuousPlay && audioSegmentEnd && audioPlayer.currentTime >= audioSegmentEnd){
     audioPlayer.pause();
     audioContinuousPlay = true;	
     }   
   //console.log(audioPlayer.currentTime);
}, false);

function playAudioSegment(startTime, endTime){
   //console.log("--- playAudioSegment(" + startTime + ", " + endTime + ")");
   audioContinuousPlay = false;
   audioSegmentEnd = endTime;
   audioPlayer.currentTime = startTime;
   audioPlayer.play();
   }
//----------------------------------------------------------------------------------------------------
var videoPlayer = document.getElementById("videoPlayer");
var videoSegmentEnd;
var videoContinuousPlay = true;

videoPlayer.addEventListener("canplay", function(){
    console.log("video can now play");
})

videoPlayer.addEventListener("timeupdate", function (){
    //console.log("video  timeupdate: " + videoPlayer.currentTime);
    if (!videoContinuousPlay && videoSegmentEnd && videoPlayer.currentTime >= videoSegmentEnd){
      videoPlayer.pause();
      videoContinuousPlay = true;	
      }   
    //console.log(videoPlayer.currentTime);
    }, false);

function playVideoSegment(startTime, endTime){
    //console.log("--- playVideoSegment(" + startTime + ", " + endTime + ")");
    videoContinuousPlay = false;
    videoSegmentEnd = endTime;
    videoPlayer.currentTime = startTime;
    videoPlayer.play();
}

function preloadVideo(){
  console.log("about to preloadVideo")
  videoPlayer.load()
  console.log("after preloadVideo")
  }

  $(window).scroll(function(){
     console.log("window scroll");
     videoPlayer.pause();
     audioPlayer.pause();
     })

</script>



  </body>
</html>

    
